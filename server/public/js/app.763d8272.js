(function(t){function e(e){for(var n,l,s=e[0],r=e[1],c=e[2],u=0,m=[];u<s.length;u++)l=s[u],Object.prototype.hasOwnProperty.call(a,l)&&a[l]&&m.push(a[l][0]),a[l]=0;for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n]);d&&d(e);while(m.length)m.shift()();return o.push.apply(o,c||[]),i()}function i(){for(var t,e=0;e<o.length;e++){for(var i=o[e],n=!0,s=1;s<i.length;s++){var r=i[s];0!==a[r]&&(n=!1)}n&&(o.splice(e--,1),t=l(l.s=i[0]))}return t}var n={},a={app:0},o=[];function l(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,l),i.l=!0,i.exports}l.m=t,l.c=n,l.d=function(t,e,i){l.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},l.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},l.t=function(t,e){if(1&e&&(t=l(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(l.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)l.d(i,n,function(e){return t[e]}.bind(null,n));return i},l.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return l.d(e,"a",e),e},l.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},l.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],r=s.push.bind(s);s.push=e,s=s.slice();for(var c=0;c<s.length;c++)e(s[c]);var d=r;o.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("56d7")},"034f":function(t,e,i){"use strict";var n=i("1356"),a=i.n(n);a.a},1356:function(t,e,i){},"46af":function(t,e,i){},"56d7":function(t,e,i){"use strict";i.r(e);var n=i("2b0e"),a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-app",[i("v-app-bar",{staticClass:"appbar",attrs:{app:"",dense:"","clipped-left":""}},[i("v-toolbar-title",{staticClass:"headline mr-3"},[i("span",[t._v("BGDSS Editor")])]),t.cache.gamePlaying?i("v-toolbar-items",[i("v-btn",{attrs:{text:""},on:{click:function(e){return t.returnFromGame()}}},[t._v("Back")])],1):i("MenuBar"),i("v-spacer"),i("v-btn",{attrs:{text:"",href:"https://github.com/KCFindstr",target:"_blank"}},[i("span",{staticClass:"mr-2"},[t._v("By KCFindstr")])])],1),t.cache.gamePlaying?[i("div",{attrs:{id:"game-main"}})]:[t.cache.music?i("LeftBar"):t._e(),t.cache.music?i("v-content",[i("v-container",[i("Editor")],1)],1):t._e()]],2)},o=[],l={music:null,noteMap:{},noteData:{},noteHead:null,playId:1,playState:1,timeline:[],head:0,formattedTime:"--:--",targetPosition:0,gamePlaying:!1,selectedNotes:{}};let s={meta:{},notes:[],bpm:[{value:100,time:[1,0,1]}],offset:0,editor:{rowheight:240,division:4,tool:0,maxrow:200,noteId:1e3,soundeffect:!0,auto:!0}};var r=s,c=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-navigation-drawer",{staticClass:"navbar",attrs:{app:"",permanent:"",stateless:"",clipped:"",width:"200"}},[i("v-list-item",[i("v-list-item-content",[i("v-list-item-title",{staticClass:"title"},[t._v("编辑工具")]),i("v-list-item-subtitle",[t._v("Edit Tools")])],1)],1),i("v-list",{attrs:{dense:"",nav:""}},[i("v-list-item-group",{attrs:{mandatory:""},model:{value:t.editor.tool,callback:function(e){t.$set(t.editor,"tool",e)},expression:"editor.tool"}},[i("v-list-item",{key:"0",attrs:{link:""},on:{click:function(e){return t.changeTool(0)}}},[i("v-list-item-icon",{staticClass:"note-icon"},[i("img",{attrs:{src:"img/note_normal.png"}})]),i("v-list-item-content",[i("v-list-item-title",[t._v("Tap")])],1)],1),i("v-list-item",{key:"1",attrs:{link:""},on:{click:function(e){return t.changeTool(1)}}},[i("v-list-item-icon",{staticClass:"note-icon"},[i("img",{attrs:{src:"img/note_flick.png"}})]),i("v-list-item-content",[i("v-list-item-title",[t._v("Flick")])],1)],1),i("v-list-item",{key:"2",attrs:{link:""},on:{click:function(e){return t.changeTool(2)}}},[i("v-list-item-icon",{staticClass:"note-icon"},[i("img",{attrs:{src:"img/note_long.png"}})]),i("v-list-item-content",[i("v-list-item-title",[t._v("Hold")])],1)],1),i("v-list-item",{key:"3",attrs:{link:""},on:{click:function(e){return t.changeTool(3)}}},[i("v-list-item-icon",{staticClass:"note-icon"},[i("v-icon",[t._v("mdi-delete")])],1),i("v-list-item-content",[i("v-list-item-title",[t._v("Remove")])],1)],1)],1)],1),i("v-divider"),i("v-list-item",[i("v-list-item-content",[i("v-list-item-title",{staticClass:"title"},[t._v("播放器")]),i("v-list-item-subtitle",[t._v("Music Player")])],1)],1),i("v-list-item",[i("v-list-item-content",[i("v-list-item-title",[t._v(t._s(t.cache.formattedTime))])],1)],1),i("v-list",{attrs:{dense:"",nav:""}},[i("v-list-item-group",{attrs:{mandatory:""},model:{value:t.cache.playState,callback:function(e){t.$set(t.cache,"playState",e)},expression:"cache.playState"}},[i("v-list-item",{key:"0",attrs:{link:""},on:{click:function(e){return t.musicPlay()}}},[i("v-list-item-icon",{staticClass:"note-icon"},[i("v-icon",[t._v("mdi-play-circle")])],1),i("v-list-item-content",[i("v-list-item-title",[t._v("Play")])],1)],1),i("v-list-item",{key:"1",attrs:{link:""},on:{click:function(e){return t.musicPause()}}},[i("v-list-item-icon",{staticClass:"note-icon"},[i("v-icon",[t._v("mdi-pause-circle")])],1),i("v-list-item-content",[i("v-list-item-title",[t._v("Pause")])],1)],1)],1)],1)],1)},d=[];let u=new Howl({src:"/se/flick.wav",preload:!0}),m=new Howl({src:"/se/perfect.wav",preload:!0}),v=document.documentElement;var p=function(t){let e=t+r.offset/1e3,i=l.timeline;while(l.head<i.length&&e>=i[l.head].time)r.editor.soundeffect&&(1==i[l.head].type?u.play():m.play()),l.head++;let n=h.getTimeBySeconds(e)-1;l.targetPosition=v.scrollHeight-v.offsetHeight-n*r.editor.rowheight,v.scrollTop=l.targetPosition};class f{static earlyThan(t,e){return this.timeDiff(t,e,60)<0}static timeDiff(t,e,i){return"number"!=typeof t&&(t=t[0]+t[1]/t[2]),"number"!=typeof e&&(e=e[0]+e[1]/e[2]),60*(t-e)/i}static updateBpm(t){if(l.music.playing()&&l.music.pause(),t){t.sort((t,e)=>this.getTime(t.time)-this.getTime(e.time)),r.bpm.splice(0,r.bpm.length);for(let e of t)r.bpm.push({value:e.value,time:[e.time[0],e.time[1],e.time[2]]})}else t=r.bpm;let e=l.music.duration()+r.offset/1e3;for(let n=1;n<t.length;n++){let i=this.getTime(t[n].time)-this.getTime(t[n-1].time);i*=60/t[n-1].value,e-=i}let i=t[t.length-1],a=8+i.time[0];e>0&&(a+=e/(60/i.value)),a=parseInt(a),r.editor.maxrow=a,n["a"].nextTick(()=>{p(l.music.seek())})}static init(){for(let t in l.noteMap){let e=l.noteMap[t];delete l.noteData[e.id],delete l.noteMap[e.id]}for(let t of r.notes)l.noteMap[t.id]=t,l.noteData[t.id]={}}static removeNote(t){let e=l.noteMap[t];if(!e)return;e.prev&&e.next?(l.noteMap[e.prev].next=0,l.noteMap[e.prev].tailtype=0,l.noteMap[e.next].prev=0,l.noteMap[e.next].headtype=0):e.next?(l.noteMap[e.next].prev=0,l.noteMap[e.next].headtype=e.headtype):e.prev&&(l.noteMap[e.prev].next=0,l.noteMap[e.prev].tailtype=e.tailtype);let i=r.notes.indexOf(e);r.notes.splice(i,1),delete l.noteMap[t],delete l.noteData[t]}static getNoteData(t){return l.noteData[t]}static getNoteById(t){return l.noteMap[t]}static makeNote(t){t.id=++r.editor.noteId,l.noteMap[t.id]=t,l.noteData[t.id]={},r.notes.push(t)}static getTime(t){return t[0]+t[1]/t[2]}static getEndNote(t){return{track:t.endtrack,time:t.endtime,type:t.tailtype}}static getFileByNoteType(t,e){if(!e)switch(t){case 0:return"img/note_normal.png";case 1:return"img/note_flick.png";case 2:return"img/note_slide_among.png";default:return"img/long_note_line.png"}switch(t){case 0:return"img/note_long.png";case 1:return"img/note_flick.png";default:return"img/note_slide_among.png"}}static loadChart(t){r.notes.splice(0,r.notes.length);for(let e of t.notes)r.notes.push(e);r.bpm.splice(0,r.bpm.length);for(let e of t.bpm)r.bpm.push(e);Object.assign(r.meta,t.meta),Object.assign(r.editor,t.editor),r.offset=t.offset,this.init(),this.updateBpm()}static getTimeInSeconds(t){let e=0;for(let n=1;n<r.bpm.length;n++){let i=r.bpm[n];if(!this.earlyThan(i.time,t))return e+=this.timeDiff(t,r.bpm[n-1].time,r.bpm[n-1].value),e;e+=this.timeDiff(i.time,r.bpm[n-1].time,r.bpm[n-1].value)}let i=r.bpm[r.bpm.length-1];return e+=this.timeDiff(t,i.time,i.value),e}static getTimeBySeconds(t){let e=1;for(let n=1;n<r.bpm.length;n++){let i=r.bpm[n],a=this.timeDiff(i.time,r.bpm[n-1].time,r.bpm[n-1].value);if(!(a<t))return e+=t/(60/r.bpm[n-1].value),e;t-=a,e=this.getTime(i.time)}let i=r.bpm[r.bpm.length-1];return e+=t/(60/i.value),e}}var h=f,g=i("5118"),b=function(t){let e=Object.keys(l.selectedNotes);if(0==e.length)return!1;for(let i of e)t&&h.removeNote(i),n["a"].delete(l.selectedNotes,i);return!0};function k(t){let e="--:--";try{e=new Date(1e3*t).toISOString().substr(14,5)}catch(i){console.log(t,i)}return e}function x(){let t=k(l.music.duration()),e=k(l.music.seek());return e+" / "+t}Object(g["setInterval"])(()=>{2!=r.editor.tool&&(l.noteHead=null),l.music&&(l.formattedTime=x())},100);var y={components:{},data:()=>({editor:r.editor,cache:l}),methods:{musicPlay:function(){if(this.cache.music.playing())return;let t=this.cache.music.seek();l.timeline=[],l.head=0;let e=l.timeline;for(let i of r.notes)if(2==i.type){let n=h.getTimeInSeconds(i.time);n>=t&&e.push({time:n,type:i.headtype}),n=h.getTimeInSeconds(i.endtime),2!=i.tailtype&&n>=t&&e.push({time:n,type:i.tailtype})}else{let n=h.getTimeInSeconds(i.time);n>=t&&e.push({time:n,type:i.type})}e.sort((t,e)=>t.time-e.time),this.cache.music.play()},musicPause:function(){this.cache.music.pause()},changeTool:function(t){b(3==t)}}},_=y,w=(i("b26a"),i("2877")),S=i("6544"),C=i.n(S),V=i("ce7e"),T=i("132d"),N=i("8860"),M=i("da13"),D=i("5d23"),B=i("1baa"),E=i("34c3"),P=i("f774"),I=Object(w["a"])(_,c,d,!1,null,"5568045a",null),O=I.exports;C()(I,{VDivider:V["a"],VIcon:T["a"],VList:N["a"],VListItem:M["a"],VListItemContent:D["a"],VListItemGroup:B["a"],VListItemIcon:E["a"],VListItemSubtitle:D["b"],VListItemTitle:D["c"],VNavigationDrawer:P["a"]});var L=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-toolbar-items",[i("FileMenu"),t.cache.music?i("EditMenu"):t._e(),t.cache.music?i("PlayMenu"):t._e(),t.cache.music?i("ViewMenu"):t._e()],1)},$=[],H=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-menu",{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(e){var n=e.on;return[i("v-btn",t._g({attrs:{text:""}},n),[t._v("\n\t\t\tFile\n\t\t")])]}}]),model:{value:t.menu,callback:function(e){t.menu=e},expression:"menu"}},[i("v-list",{attrs:{dense:""}},[i("v-list-item",{on:{click:function(e){return e.stopPropagation(),t.importMusic()}}},[i("v-list-item-title",[t._v("Import Music")])],1),i("v-list-item",{attrs:{disabled:!t.cache.music},on:{click:function(e){return e.stopPropagation(),t.importChart()}}},[i("v-list-item-title",[t._v("Import Chart")])],1),i("v-list-item",{attrs:{disabled:!t.cache.music},on:{click:function(e){return e.stopPropagation(),t.exportChart()}}},[i("v-list-item-title",[t._v("Export")])],1)],1),i("v-dialog",{attrs:{"max-width":"600"},model:{value:t.chartdialog,callback:function(e){t.chartdialog=e},expression:"chartdialog"}},[i("v-card",[i("v-card-title",{staticClass:"headline"},[t._v("Import Chart File")]),i("v-card-text",[t._v("\n\t\t\t\tChoose a chart file.\n\t\t\t\t"),i("v-file-input",{attrs:{label:"Click to select chart file",accept:".json"},model:{value:t.chart,callback:function(e){t.chart=e},expression:"chart"}})],1),i("v-card-actions",[i("div",{staticClass:"flex-grow-1"}),i("v-btn",{attrs:{color:"red darken-1",text:""},on:{click:function(e){t.chartdialog=!1}}},[t._v("\n\t\t\t\t\tCancel\n\t\t\t\t")]),i("v-btn",{attrs:{color:"green darken-1",text:"",disabled:!t.chart},on:{click:function(e){return t.importChartEnd()}}},[t._v("\n\t\t\t\t\tDone\n\t\t\t\t")])],1)],1)],1),i("v-dialog",{attrs:{"max-width":"600"},model:{value:t.filedialog,callback:function(e){t.filedialog=e},expression:"filedialog"}},[i("v-card",[i("v-card-title",{staticClass:"headline"},[t._v("Import Music File")]),i("v-card-text",[t._v("\n\t\t\t\tAdd a music file.\n\t\t\t\t"),i("v-file-input",{attrs:{label:"Click to select music file",accept:".mp3,.wav,.ogg",required:""},model:{value:t.music,callback:function(e){t.music=e},expression:"music"}})],1),i("v-card-actions",[i("div",{staticClass:"flex-grow-1"}),i("v-btn",{attrs:{color:"red darken-1",text:""},on:{click:function(e){t.filedialog=!1}}},[t._v("\n\t\t\t\t\tCancel\n\t\t\t\t")]),i("v-btn",{attrs:{color:"green darken-1",text:"",disabled:!t.music},on:{click:function(e){return t.importMusicEnd()}}},[t._v("\n\t\t\t\t\tDone\n\t\t\t\t")])],1)],1)],1)],1)},R=[],j=i("21a6"),F={components:{},data:()=>({editor:r.editor,filedialog:!1,chartdialog:!1,exportdialog:!1,menu:!1,music:null,chart:null,cache:l}),methods:{importMusic:function(){this.music=null,this.menu=!1,this.filedialog=!0},importChart:function(){this.chart=null,this.menu=!1,this.chartdialog=!0},exportChart:function(){this.menu=!1,this.exportdialog=!0;let t=new Blob([JSON.stringify(r)],{type:"application/json"});Object(j["saveAs"])(t,"level.json")},importChartEnd:function(){if(this.chartdialog=!1,this.chart){var t=new FileReader;t.onload=function(){b(),h.loadChart(JSON.parse(t.result)),n["a"].nextTick(()=>{let t=document.documentElement;t.scrollTop=t.scrollHeight-t.offsetHeight})},t.readAsText(this.chart)}},importMusicEnd:function(){if(this.filedialog=!1,this.music){var t=new FileReader;t.onload=()=>{let e=new Howl({src:t.result,preload:!0,onload:()=>{this.cache.music=e,h.updateBpm(),n["a"].nextTick(()=>{let t=document.documentElement;t.scrollTop=t.scrollHeight-t.offsetHeight})}})},t.readAsDataURL(this.music)}}}},G=F,A=i("8336"),q=i("b0af"),J=i("99d9"),z=i("169a"),K=i("23a7"),U=i("e449"),X=Object(w["a"])(G,H,R,!1,null,"92bebfe2",null),W=X.exports;C()(X,{VBtn:A["a"],VCard:q["a"],VCardActions:J["a"],VCardText:J["b"],VCardTitle:J["c"],VDialog:z["a"],VFileInput:K["a"],VList:N["a"],VListItem:M["a"],VListItemTitle:D["c"],VMenu:U["a"]});var Y=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-menu",{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(e){var n=e.on;return[i("v-btn",t._g({attrs:{text:""}},n),[t._v("\n\t\t\tEdit\n\t\t")])]}}]),model:{value:t.menu,callback:function(e){t.menu=e},expression:"menu"}},[i("v-list",{attrs:{dense:""}},[i("v-list-item",{on:{click:function(e){return t.openBpmDialog()}}},[i("v-list-item-title",[t._v("BPM and offset")])],1),i("v-list-item",{on:{click:function(e){return t.openSettingDialog()}}},[i("v-list-item-title",[t._v("Settings")])],1),i("v-divider"),i("v-list-item",{on:{click:function(e){return t.flipHorizontally()}}},[i("v-list-item-title",[t._v("Flip horizontally")])],1),i("v-list-item",{on:{click:function(e){return t.openRangeSelectDialog()}}},[i("v-list-item-title",[t._v("Range select")])],1)],1),i("v-dialog",{attrs:{"max-width":"600"},model:{value:t.bpmdialog,callback:function(e){t.bpmdialog=e},expression:"bpmdialog"}},[i("v-card",[i("v-card-title",{staticClass:"headline"},[t._v("BPM and Offset")]),i("v-card-text",[i("v-form",{model:{value:t.bpmvalid,callback:function(e){t.bpmvalid=e},expression:"bpmvalid"}},[i("v-container",[t._l(t.bpm,function(e,n){return i("v-row",{key:n,attrs:{dense:""}},[i("v-col",{attrs:{cols:"2"}},[i("v-subheader",[t._v("# "+t._s(n))])],1),i("v-col",{attrs:{cols:"2"}},[i("v-text-field",{attrs:{rules:t.timeRule,label:"Bar","hide-details":"",required:""},model:{value:e.time[0],callback:function(i){t.$set(e.time,0,t._n(i))},expression:"b.time[0]"}})],1),i("v-col",{attrs:{cols:"1"}},[i("v-text-field",{attrs:{rules:t.positiveRule,label:"N","hide-details":"",required:""},model:{value:e.time[1],callback:function(i){t.$set(e.time,1,t._n(i))},expression:"b.time[1]"}})],1),i("v-col",{attrs:{cols:"1"}},[i("v-text-field",{attrs:{rules:t.timeRule,label:"D","hide-details":"",required:""},model:{value:e.time[2],callback:function(i){t.$set(e.time,2,t._n(i))},expression:"b.time[2]"}})],1),i("v-col",{attrs:{cols:"4"}},[i("v-text-field",{attrs:{rules:t.bpmRule,label:"BPM value","hide-details":"",required:""},model:{value:e.value,callback:function(i){t.$set(e,"value",t._n(i))},expression:"b.value"}})],1),i("v-col",{attrs:{cols:"1"}},[i("v-subheader",[i("v-btn",{attrs:{text:""},on:{click:function(e){return t.removeBpm(n)}}},[i("v-icon",[t._v("mdi-close")])],1)],1)],1)],1)}),i("v-row",{staticClass:"justify-space-around"},[i("v-col",{attrs:{cols:"2"}},[i("v-btn",{attrs:{text:""},on:{click:function(e){return t.newBpm()}}},[i("v-icon",[t._v("mdi-plus")])],1)],1),i("v-col",{attrs:{cols:"6"}},[i("v-text-field",{attrs:{rules:t.offsetRule,label:"Offset (ms)",required:""},model:{value:t.offset,callback:function(e){t.offset=e},expression:"offset"}})],1)],1)],2)],1)],1),i("v-card-actions",[i("div",{staticClass:"flex-grow-1"}),i("v-btn",{attrs:{color:"red darken-1",text:""},on:{click:function(e){t.bpmdialog=!1}}},[t._v("\n\t\t\t\t\tCancel\n\t\t\t\t")]),i("v-btn",{attrs:{color:"green darken-1",text:"",disabled:!t.bpmvalid},on:{click:function(e){return t.saveBpm()}}},[t._v("\n\t\t\t\t\tDone\n\t\t\t\t")])],1)],1)],1),i("v-dialog",{attrs:{"max-width":"600"},model:{value:t.settingdialog,callback:function(e){t.settingdialog=e},expression:"settingdialog"}},[i("v-card",[i("v-card-title",{staticClass:"headline"},[t._v("Settings")]),i("v-card-text",[i("v-switch",{attrs:{label:"Sound Effect"},model:{value:t.editor.soundeffect,callback:function(e){t.$set(t.editor,"soundeffect",e)},expression:"editor.soundeffect"}})],1),i("v-card-actions",[i("div",{staticClass:"flex-grow-1"}),i("v-btn",{attrs:{color:"green darken-1",text:""},on:{click:function(e){t.settingdialog=!1}}},[t._v("\n\t\t\t\t\tDone\n\t\t\t\t")])],1)],1)],1),i("v-dialog",{attrs:{"max-width":"600"},model:{value:t.rangedialog,callback:function(e){t.rangedialog=e},expression:"rangedialog"}},[i("v-card",[i("v-card-title",{staticClass:"headline"},[t._v("Range Selection")]),i("v-card-text",[i("v-form",{model:{value:t.rangevalid,callback:function(e){t.rangevalid=e},expression:"rangevalid"}},[i("v-container",[i("v-row",{attrs:{dense:""}},[i("v-col",{attrs:{cols:"2"}},[i("v-subheader",[t._v("Start")])],1),i("v-col",{attrs:{cols:"2"}},[i("v-text-field",{attrs:{rules:t.timeRule,label:"Bar","hide-details":"",required:""},model:{value:t.rangeStart[0],callback:function(e){t.$set(t.rangeStart,0,t._n(e))},expression:"rangeStart[0]"}})],1),i("v-col",{attrs:{cols:"1"}},[i("v-text-field",{attrs:{rules:t.positiveRule,label:"N","hide-details":"",required:""},model:{value:t.rangeStart[1],callback:function(e){t.$set(t.rangeStart,1,t._n(e))},expression:"rangeStart[1]"}})],1),i("v-col",{attrs:{cols:"1"}},[i("v-text-field",{attrs:{rules:t.timeRule,label:"D","hide-details":"",required:""},model:{value:t.rangeStart[2],callback:function(e){t.$set(t.rangeStart,2,t._n(e))},expression:"rangeStart[2]"}})],1),i("v-col",{attrs:{cols:"2"}},[i("v-subheader",[t._v("End")])],1),i("v-col",{attrs:{cols:"2"}},[i("v-text-field",{attrs:{rules:t.timeRule,label:"Bar","hide-details":"",required:""},model:{value:t.rangeEnd[0],callback:function(e){t.$set(t.rangeEnd,0,t._n(e))},expression:"rangeEnd[0]"}})],1),i("v-col",{attrs:{cols:"1"}},[i("v-text-field",{attrs:{rules:t.positiveRule,label:"N","hide-details":"",required:""},model:{value:t.rangeEnd[1],callback:function(e){t.$set(t.rangeEnd,1,t._n(e))},expression:"rangeEnd[1]"}})],1),i("v-col",{attrs:{cols:"1"}},[i("v-text-field",{attrs:{rules:t.timeRule,label:"D","hide-details":"",required:""},model:{value:t.rangeEnd[2],callback:function(e){t.$set(t.rangeEnd,2,t._n(e))},expression:"rangeEnd[2]"}})],1)],1)],1)],1)],1),i("v-card-actions",[i("div",{staticClass:"flex-grow-1"}),i("v-btn",{attrs:{color:"red darken-1",text:""},on:{click:function(e){t.rangedialog=!1}}},[t._v("\n\t\t\t\t\tCancel\n\t\t\t\t")]),i("v-btn",{attrs:{color:"green darken-1",text:"",disabled:!t.rangevalid},on:{click:function(e){return t.rangeSelectEnd()}}},[t._v("\n\t\t\t\t\tDone\n\t\t\t\t")])],1)],1)],1)],1)},Q=[],Z=function(t){l.noteHead&&(l.noteHead=null);let e=[t],i=t,a=l.noteMap;while(i.next)i=a[i.next],e.push(i);i=t;while(i.prev)i=a[i.prev],e.push(i);for(i of e)l.selectedNotes[i.id]?n["a"].delete(l.selectedNotes,i.id):n["a"].set(l.selectedNotes,i.id,i)},tt={components:{},data:()=>({editor:r.editor,bpmdialog:!1,settingdialog:!1,rangedialog:!1,bpmvalid:!1,rangevalid:!1,bpm:[],rangeStart:[1,0,1],rangeEnd:[1,0,1],offset:r.offset,timeRule:[t=>t==parseInt(t)&&t>=1||"X"],positiveRule:[t=>t==parseInt(t)&&t>=0||"X"],bpmRule:[t=>t>=1&&t<=1e4||"Invalid BPM"],offsetRule:[t=>t>=-1e5&&t<=1e5||"Invalid offset"],menu:!1}),methods:{openBpmDialog:function(){this.menu=!1,this.bpm.splice(0,this.bpm.length);for(let t of r.bpm)this.bpm.push({value:t.value,time:[t.time[0],t.time[1],t.time[2]]});this.offset=r.offset,this.bpmdialog=!0},openSettingDialog:function(){this.menu=!1,this.settingdialog=!0},openRangeSelectDialog:function(){this.menu=!1,this.rangedialog=!0},saveBpm:function(){this.bpmdialog=!1,r.offset=this.offset,h.updateBpm(this.bpm)},removeBpm:function(t){this.bpm.length<=1||this.bpm.splice(t,1)},newBpm:function(){let t=this.bpm[this.bpm.length-1];this.bpm.push({value:t.value,time:[t.time[0],t.time[1],t.time[2]]})},flipHorizontally:function(){for(let t in l.selectedNotes){let e=l.selectedNotes[t];e.track=6-e.track,void 0!=e.endtrack&&(e.endtrack=6-e.endtrack)}},rangeSelectEnd:function(){let t=this.rangeStart,e=this.rangeEnd;b();let i={};for(let n of r.notes){let a=null,o=null,s=n;while(s.prev)s=l.noteMap[s.prev];a=s.time,s=n;while(s.next)s=l.noteMap[s.next];o=s.endtime||s.time,i[s.id]||(h.earlyThan(a,t)||h.earlyThan(e,o)||(i[s.id]=s))}for(let n in i)Z(i[n]);this.rangedialog=!1}}},et=tt,it=i("62ad"),nt=i("a523"),at=i("4bd4"),ot=i("0fd9"),lt=i("e0c7"),st=i("b73d"),rt=i("8654"),ct=Object(w["a"])(et,Y,Q,!1,null,"6bfc144e",null),dt=ct.exports;C()(ct,{VBtn:A["a"],VCard:q["a"],VCardActions:J["a"],VCardText:J["b"],VCardTitle:J["c"],VCol:it["a"],VContainer:nt["a"],VDialog:z["a"],VDivider:V["a"],VForm:at["a"],VIcon:T["a"],VList:N["a"],VListItem:M["a"],VListItemTitle:D["c"],VMenu:U["a"],VRow:ot["a"],VSubheader:lt["a"],VSwitch:st["a"],VTextField:rt["a"]});var ut=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-menu",{attrs:{"offset-y":"","close-on-content-click":!1},scopedSlots:t._u([{key:"activator",fn:function(e){var n=e.on;return[i("v-btn",t._g({attrs:{text:""}},n),[t._v("\n\t\t\t\tGame\n\t\t\t")])]}}]),model:{value:t.menu,callback:function(e){t.menu=e},expression:"menu"}},[i("v-list",{attrs:{dense:""}},[i("v-list-item",{on:{click:function(e){return t.startGame()}}},[i("v-list-item-title",[t._v("Play from beginning")])],1),i("v-list-item",{on:{click:function(e){t.startGame(t.cache.music.seek())}}},[i("v-list-item-title",[t._v("Play from current location")])],1),i("v-divider"),i("v-list-item",[i("v-list-item-action",[i("v-checkbox",{model:{value:t.editor.auto,callback:function(e){t.$set(t.editor,"auto",e)},expression:"editor.auto"}})],1),i("v-list-item-title",[t._v("Auto")])],1),i("GameSettings",{on:{click:function(e){t.menu=!1}}})],1)],1)},mt=[],vt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-list-item",{on:{click:function(e){t.$emit("click"),t.openGameSettings()}}},[i("v-list-item-title",[t._v("Game Settings")]),i("v-dialog",{attrs:{"max-width":"600"},model:{value:t.gsdialog,callback:function(e){t.gsdialog=e},expression:"gsdialog"}},[i("v-card",[i("v-card-title",{staticClass:"headline"},[t._v("Game Settings")]),i("v-card-text",[i("v-slider",{attrs:{label:"Note Speed",min:"1",max:"20",step:"0.1"},scopedSlots:t._u([{key:"append",fn:function(){return[i("v-text-field",{staticClass:"mt-0 pt-0",staticStyle:{width:"60px"},attrs:{"hide-details":"","single-line":"",type:"number",min:"1",max:"20",step:"0.1"},model:{value:t.config.speed,callback:function(e){t.$set(t.config,"speed",e)},expression:"config.speed"}})]},proxy:!0}]),model:{value:t.config.speed,callback:function(e){t.$set(t.config,"speed",e)},expression:"config.speed"}}),i("v-slider",{attrs:{label:"Note Size",min:"0.1",max:"2",step:"0.1"},scopedSlots:t._u([{key:"append",fn:function(){return[i("v-text-field",{staticClass:"mt-0 pt-0",staticStyle:{width:"60px"},attrs:{"hide-details":"","single-line":"",type:"number",min:"0.1",max:"2",step:"0.1"},model:{value:t.config.scale,callback:function(e){t.$set(t.config,"scale",e)},expression:"config.scale"}})]},proxy:!0}]),model:{value:t.config.scale,callback:function(e){t.$set(t.config,"scale",e)},expression:"config.scale"}}),i("v-slider",{attrs:{label:"Simu. Notes Helper Weight",min:"0",max:"10",step:"1"},scopedSlots:t._u([{key:"append",fn:function(){return[i("v-text-field",{staticClass:"mt-0 pt-0",staticStyle:{width:"60px"},attrs:{"hide-details":"","single-line":"",type:"number",min:"0",max:"10",step:"1"},model:{value:t.config.simuhint,callback:function(e){t.$set(t.config,"simuhint",e)},expression:"config.simuhint"}})]},proxy:!0}]),model:{value:t.config.simuhint,callback:function(e){t.$set(t.config,"simuhint",e)},expression:"config.simuhint"}})],1),i("v-card-actions",[i("div",{staticClass:"flex-grow-1"}),i("v-btn",{attrs:{color:"red darken-1",text:""},on:{click:function(e){t.gsdialog=!1}}},[t._v("Cancel")]),i("v-btn",{attrs:{color:"green darken-1",text:""},on:{click:function(e){return t.saveSettings()}}},[t._v("Done")])],1)],1)],1)],1)},pt=[],ft={components:{},data:()=>({editor:r.editor,cache:l,gsdialog:0,config:{flick:0,long:0,normal:0,se:0,line:0,speed:10,scale:1.5,simuhint:5}}),methods:{openGameSettings:function(){let t=cookie.get("config");if(t&&t.length){t=JSON.parse(t);for(let e in t)this.config[e]=t[e]}this.gsdialog=!0},saveSettings:function(){cookie.set("config",JSON.stringify(this.config)),this.gsdialog=!1}}},ht=ft,gt=i("ba0d"),bt=Object(w["a"])(ht,vt,pt,!1,null,"277ffa0e",null),kt=bt.exports;function xt(){l.music.playing()&&(l.music.pause(),l.playState=0),l.gamePlaying=!0,window.BGDSS.chart=JSON.stringify(r),window.BGDSS.auto=r.editor.auto,window.BGDSS.reloadConfig(),n["a"].nextTick(()=>{l.timeline=[],window.BGDSS.startGame()})}C()(bt,{VBtn:A["a"],VCard:q["a"],VCardActions:J["a"],VCardText:J["b"],VCardTitle:J["c"],VDialog:z["a"],VListItem:M["a"],VListItemTitle:D["c"],VSlider:gt["a"],VTextField:rt["a"]});var yt={components:{GameSettings:kt},data:()=>({editor:r.editor,cache:l,menu:0}),methods:{startGame:function(t){void 0==t&&(t=0),window.BGDSS.playLocation=t,this.menu=0,xt()}}},_t=yt,wt=i("ac7c"),St=i("1800"),Ct=Object(w["a"])(_t,ut,mt,!1,null,"08d9b7f9",null),Vt=Ct.exports;C()(Ct,{VBtn:A["a"],VCheckbox:wt["a"],VDivider:V["a"],VList:N["a"],VListItem:M["a"],VListItemAction:St["a"],VListItemTitle:D["c"],VMenu:U["a"]});var Tt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-menu",{attrs:{"offset-y":"","close-on-content-click":!1},scopedSlots:t._u([{key:"activator",fn:function(e){var n=e.on;return[i("v-btn",t._g({attrs:{text:""}},n),[t._v("\n\t\t\t\tView\n\t\t\t")])]}}]),model:{value:t.menu,callback:function(e){t.menu=e},expression:"menu"}},[i("v-list",{attrs:{dense:""}},[i("v-subheader",[t._v("Vertical Stretch")]),i("v-list-item",{attrs:{dense:""}},[i("v-list-item-content",[i("v-slider",{attrs:{min:"100",max:"300",step:"10"},on:{blur:function(e){return t.updateRowheight()}},model:{value:t.rowheight,callback:function(e){t.rowheight=e},expression:"rowheight"}})],1)],1),i("v-divider"),i("v-subheader",[t._v("Horizontal Division")]),i("v-list-item-group",{attrs:{color:"primary",mandatory:""},model:{value:t.editor.division,callback:function(e){t.$set(t.editor,"division",e)},expression:"editor.division"}},t._l(t.gridvalues,function(e){return i("v-list-item",{key:e,attrs:{value:e},on:{click:function(i){return t.changeGrid(e)}}},[i("v-list-item-title",[t._v("1 / "+t._s(e))])],1)}),1)],1)],1)},Nt=[],Mt={components:{},data:()=>({editor:r.editor,gridvalues:[1,2,3,4,6,8,12,16],menu:0,rowheight:r.editor.rowheight}),methods:{changeGrid:function(t){this.editor.division=t},updateRowheight(){r.editor.rowheight=this.rowheight}}},Dt=Mt,Bt=Object(w["a"])(Dt,Tt,Nt,!1,null,"ef6b5a40",null),Et=Bt.exports;C()(Bt,{VBtn:A["a"],VDivider:V["a"],VList:N["a"],VListItem:M["a"],VListItemContent:D["a"],VListItemGroup:B["a"],VListItemTitle:D["c"],VMenu:U["a"],VSlider:gt["a"],VSubheader:lt["a"]});var Pt={components:{FileMenu:W,EditMenu:dt,PlayMenu:Vt,ViewMenu:Et},data:()=>({editor:r.editor,cache:l})},It=Pt,Ot=i("2a7f"),Lt=Object(w["a"])(It,L,$,!1,null,null,null),$t=Lt.exports;C()(Lt,{VToolbarItems:Ot["a"]});var Ht=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"chart"},[t._l(t.editor.maxrow,function(e){return i("div",{key:-e-1,staticClass:"chart-row",style:{height:t.editor.rowheight+"px"}},[i("div",{staticClass:"number pink--text mr-3"},[t._v(t._s(t.editor.maxrow-e+1))]),i("div",{staticClass:"single-row"},t._l(t.editor.division,function(n){return i("div",{key:n,style:{height:t.editor.rowheight/t.editor.division+"px"}},t._l(7,function(a){return i("div",{key:a,staticClass:"block",style:t.getBorderStyle(e*t.editor.division+n,a),on:{click:function(i){return t.handleBlockClick(i,e,n,a)}}})}),0)}),0)])}),t._l(t.notes,function(e){return i("div",{key:e.id},[e.type<2?i("div",{staticClass:"note",class:{"note-selected":!!t.cache.selectedNotes[e.id],"note-tap":1===e.type,"note-flick":2===e.type},style:t.computeNotePosition(e),on:{click:function(i){return t.handleNoteMouseDown(e)},contextmenu:function(i){return i.preventDefault(),t.removeNote(e)}}},[i("img",{attrs:{src:t.getFileByNoteType(e.type)}})]):2===e.type?i("div",{staticClass:"note-hold"},[i("div",{staticClass:"note",class:{"note-selected":!!t.cache.selectedNotes[e.id]},style:t.computeNotePosition(e),on:{click:function(i){return t.handleNoteMouseDown(e,0)},contextmenu:function(i){return i.preventDefault(),t.removeNote(e)}}},[i("img",{attrs:{src:t.getFileByNoteType(e.headtype,!0)}})]),i("div",{staticClass:"long-note",class:{"note-selected":!!t.cache.selectedNotes[e.id]},style:t.computeLongPosition(e),on:{click:function(i){return t.handleNoteMouseDown(e,1)},contextmenu:function(i){return i.preventDefault(),t.removeNote(e)}}},[i("img",{attrs:{src:t.getFileByNoteType(-1)}})]),2==e.tailtype||t.cache.noteHead&&t.cache.noteHead.parent&&t.cache.noteHead.parent.id==e.id?t._e():i("div",{staticClass:"note",class:{"note-selected":!!t.cache.selectedNotes[e.id]},style:t.computeNotePosition(t.getEndNote(e)),on:{click:function(i){return t.handleNoteMouseDown(e,2)},contextmenu:function(i){return i.preventDefault(),t.removeNote(e)}}},[i("img",{attrs:{src:t.getFileByNoteType(e.tailtype,!0)}})])]):t._e()])}),t.cache.noteHead?i("div",{staticClass:"note note-head",style:t.computeNotePosition(t.cache.noteHead)},[i("img",{attrs:{src:t.getFileByNoteType(0,!0)}})]):t._e(),t._m(0)],2)},Rt=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"playline"},[i("div",[t._v("Playback Position")])])}],jt=i("fcf4");function Ft(t,e,i){let n=l.noteHead;if(n){if(!h.earlyThan(n.time,t.time))return void(l.noteHead=null);if(e&&(e.prev||0!=i))return void(l.noteHead=null);let a={type:2,time:n.time,track:n.track,endtrack:t.track,endtime:t.time,headtype:n.parent?2:0,tailtype:e?2:n.type,prev:n.parent?n.parent.id:0,next:e?e.id:0};return h.makeNote(a),n.parent&&(n.parent.tailtype=2,n.parent.next=a.id),e&&(e.headtype=2,e.prev=a.id),void(l.noteHead=null)}if(e){if(2!=i||e.next)return;l.noteHead={track:e.endtrack,time:e.endtime,type:e.tailtype,parent:e}}else l.noteHead={time:t.time,track:t.track,type:0}}var Gt={components:{},data:()=>({notes:r.notes,editor:r.editor,cache:l}),methods:{getBorderStyle:function(t,e){let i={},n="2px solid ";return t%this.editor.division===0?n+="black":2*t%this.editor.division===0?n+=jt["a"].lightBlue.base:3*t%this.editor.division===0?n+=jt["a"].green.base:4*t%this.editor.division===0?n+=jt["a"].orange.base:n="1px dashed black",t===this.editor.division+1&&(i.borderTop="2px solid black"),1===e&&(i.borderLeft="1px solid black"),i.height=this.editor.rowheight/this.editor.division,i.borderBottom=n,i},computeNoteRawPosition:function(t){let e={};e.left=80*t.track+72;let i=h.getTime(t.time)-1;return e.bottom=i*this.editor.rowheight,e},computeNotePosition:function(t){let e=this.computeNoteRawPosition(t);return e.bottom-=16,e.left+="px",e.bottom+="px",e},computeLongPosition:function(t){let e={},i=this.computeNoteRawPosition(t),n=this.computeNoteRawPosition(this.getEndNote(t));e.height=n.bottom-i.bottom+"px",e.bottom=i.bottom+"px",e.left=i.left+5+"px";let a=Math.atan2(n.left-i.left,i.bottom-n.bottom);return e.transform="skew("+a+"rad)",e},getFileByNoteType:function(t,e){return h.getFileByNoteType(t,e)},getEndNote:function(t){return h.getEndNote(t)},removeNote:function(t){h.removeNote(t.id)},handleNoteMouseDown:function(t,e){3!=this.editor.tool?2!=this.editor.tool?2!=e||t.next?Z(t):t.tailtype=this.editor.tool:1==e||null==e?Z(t):Ft({time:0==e?t.time:t.endtime,track:0==e?t.track:t.endtrack},t,e):this.removeNote(t)},handleBlockClick:function(t,e,i,n){if(b()||3==this.editor.tool)return;i=this.editor.division-i,e=this.editor.maxrow-e+1,n--;let a=this.editor.rowheight/this.editor.division;t.offsetY<a/2&&(i++,i>=this.editor.division&&(i=0,e++));let o=[e,i,this.editor.division];if(2==this.editor.tool)Ft({time:o,track:n});else{let t={time:o,track:n,type:this.editor.tool};h.makeNote(t)}}}},At=Gt,qt=(i("a031"),Object(w["a"])(At,Ht,Rt,!1,null,"1297c4f5",null)),Jt=qt.exports,zt={name:"App",components:{LeftBar:O,MenuBar:$t,Editor:Jt},data:()=>({cache:l}),methods:{returnFromGame:function(){let t=window.BGDSS.endGame();l.gamePlaying=!1,l.music.seek(t/1e3),n["a"].nextTick(()=>{p(t/1e3)})}}};let Kt=document.documentElement;function Ut(){l.music.pause(),l.playState=1;let t=Kt.scrollHeight-Kt.offsetHeight-Kt.scrollTop;t/=r.editor.rowheight,t+=1;let e=h.getTimeInSeconds(t)-r.offset/1e3;e=Math.max(0,e),l.music.seek(e)}function Xt(t,e){let i=r.editor.division,n=[...t];if(0==e){for(let t=0;t<i;t++)if(t*n[2]>n[1]*i)return n[1]=t,n[2]=i,n;if(n[0]>=r.editor.maxrow)return n;n[0]++,n[1]=0,n[2]=i}else{for(let t=i-1;t>=0;t--)if(t*n[2]<n[1]*i)return n[1]=t,n[2]=i,n;if(n[0]<=1)return n;n[0]--,n[1]=i-1,n[2]=i}return n}function Wt(t,e,i){let n=t[e]+(2==i?-1:1);n=Math.max(0,Math.min(6,n)),t[e]=n}function Yt(t,e){let i=Object.keys(l.selectedNotes);if(0!=i.length){t.preventDefault();for(let t of i){let i=l.selectedNotes[t];e<2?(i.time=Xt(i.time,e),i.endtime&&(i.endtime=Xt(i.endtime,e))):(Wt(i,"track",e),void 0!=i.endtrack&&Wt(i,"endtrack",e))}}}function Qt(){b(!0)}Object(g["setInterval"])(()=>{l.music&&l.music.playing()&&p(l.music.seek())},15),window.addEventListener("scroll",function(){!l.music||Math.abs(Kt.scrollTop-l.targetPosition)<=1||Ut()}),window.addEventListener("keydown",t=>{switch(t.key){case"ArrowUp":Yt(t,0);break;case"ArrowDown":Yt(t,1);break;case"ArrowLeft":Yt(t,2);break;case"ArrowRight":Yt(t,3);break;case"Delete":Qt();break}});var Zt=zt,te=(i("034f"),i("862a"),i("7496")),ee=i("40dc"),ie=i("a75b"),ne=i("2fa4"),ae=Object(w["a"])(Zt,a,o,!1,null,"a6f2c1b8",null),oe=ae.exports;C()(ae,{VApp:te["a"],VAppBar:ee["a"],VBtn:A["a"],VContainer:nt["a"],VContent:ie["a"],VSpacer:ne["a"],VToolbarItems:Ot["a"],VToolbarTitle:Ot["b"]});var le=i("f309");n["a"].use(le["a"]);var se=new le["a"]({icons:{iconfont:"mdi"}});n["a"].config.productionTip=!1,new n["a"]({vuetify:se,render:t=>t(oe)}).$mount("#app")},"5d8c":function(t,e,i){},"755b":function(t,e,i){},"862a":function(t,e,i){"use strict";var n=i("46af"),a=i.n(n);a.a},a031:function(t,e,i){"use strict";var n=i("5d8c"),a=i.n(n);a.a},b26a:function(t,e,i){"use strict";var n=i("755b"),a=i.n(n);a.a}});
//# sourceMappingURL=app.763d8272.js.map